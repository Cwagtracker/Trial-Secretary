<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    
    <!-- Basic CSS - inline for debugging -->
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>C-WAGS Trial Management System</h2>
                <p>Please login to continue</p>
            </div>
            
            <div id="message-area"></div>
            
            <form id="login-form-element">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" required value="admin@cwags.org">
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" required value="admin123">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="remember-me"> Remember me
                    </label>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="main-app">
        <header class="app-header">
            <div>
                <h1>C-WAGS Trial Management System</h1>
            </div>
            <div>
                <span id="user-name">System Administrator</span>
                <button id="logout-btn" class="btn" style="width: auto; margin-left: 15px;">Logout</button>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-module="dashboard">üìä Dashboard</button>
            <button class="nav-btn" data-module="trial-setup">üéØ Trial Setup</button>
            <button class="nav-btn" data-module="entries">üìù Entry Management</button>
            <button class="nav-btn" data-module="paperwork">üìÑ Paperwork Generation</button>
            <button class="nav-btn" data-module="scoring">üèÜ Scoring & Results</button>
            <button class="nav-btn" data-module="admin">‚öôÔ∏è Admin Panel</button>
        </nav>

        <main class="main-content">
            <div id="module-container">
                <div class="dashboard-module">
                    <h2>Welcome to C-WAGS Trial Management System</h2>
                    <p>System is running successfully! üéâ</p>
                    <div style="margin-top: 20px;">
                        <h3>System Status:</h3>
                        <ul>
                            <li>‚úÖ Authentication: Working</li>
                            <li>‚úÖ Data Storage: Available</li>
                            <li>‚úÖ User Interface: Loaded</li>
                            <li>‚úÖ Core Functions: Ready</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

  <script>
    // Load core modules first
    const loadScript = (src) => {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    };

  <!-- Replace your entire <script> section at the bottom of index.html with this: -->


// Simple working authentication - embedded in HTML
class SimpleDataManager {
    static saveData(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (error) {
            console.error('Error saving data:', error);
            return false;
        }
    }

    static getData(key, defaultValue = null) {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        } catch (error) {
            console.error('Error loading data:', error);
            return defaultValue;
        }
    }

    static getSystemStats() {
        const trials = this.getData('cwags_trials', []);
        const entries = this.getData('cwags_entries', []);
        const users = this.getData('cwags_users', []);
        
        return {
            totalTrials: trials.length,
            activeTrials: trials.filter(t => t.status === 'active' || !t.status).length,
            pendingTrials: trials.filter(t => t.status === 'pending').length,
            totalEntries: entries.length,
            entriesThisMonth: 0,
            confirmedEntries: entries.filter(e => e.status === 'confirmed').length,
            totalUsers: users.length,
            activeUsers: users.filter(u => u.isActive).length,
            dataSize: this.calculateDataSize()
        };
    }

    static calculateDataSize() {
        let totalSize = 0;
        for (let key in localStorage) {
            if (key.startsWith('cwags_')) {
                totalSize += localStorage[key].length;
            }
        }
        return totalSize;
    }

    static formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
}

class SimpleAuth {
    static currentUser = null;

    static init() {
        console.log('üîê Auth system initialized');
        this.loadDefaultUsers();
        this.setupEventListeners();
    }

    static loadDefaultUsers() {
        let users = SimpleDataManager.getData('cwags_users', []);
        
        if (users.length === 0) {
            const defaultAdmin = {
                id: 'admin-001',
                email: 'admin@cwags.org',
                password: 'admin123', // Plain text for demo
                firstName: 'System',
                lastName: 'Administrator',
                role: 'admin',
                isActive: true,
                permissions: ['all']
            };
            users.push(defaultAdmin);
            SimpleDataManager.saveData('cwags_users', users);
            console.log('‚úÖ Default admin created');
        }
    }

    static setupEventListeners() {
        const loginForm = document.getElementById('login-form-element');
        if (loginForm) {
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleLogin();
            });
        }

        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                this.logout();
            });
        }
    }

    static handleLogin() {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        console.log('üîë Attempting login:', email);

        if (!email || !password) {
            this.showMessage('Please fill in all fields', 'error');
            return;
        }

        const users = SimpleDataManager.getData('cwags_users', []);
        const user = users.find(u => 
            u.email.toLowerCase() === email.toLowerCase() && 
            u.password === password &&
            u.isActive
        );

        if (user) {
            console.log('‚úÖ Login successful:', user);
            this.currentUser = user;
            localStorage.setItem('cwags_current_user', JSON.stringify(user));
            
            this.showMessage('Login successful!', 'success');
            
            setTimeout(() => {
                showMainApp();
                this.updateUserDisplay();
            }, 1000);
        } else {
            console.log('‚ùå Login failed for:', email);
            this.showMessage('Invalid email or password', 'error');
        }
    }

    static logout() {
        this.currentUser = null;
        localStorage.removeItem('cwags_current_user');
        showAuthModal();
    }

    static isLoggedIn() {
        if (this.currentUser) return true;
        
        const stored = localStorage.getItem('cwags_current_user');
        if (stored) {
            this.currentUser = JSON.parse(stored);
            return true;
        }
        return false;
    }

    static getCurrentUser() {
        if (!this.currentUser) {
            const stored = localStorage.getItem('cwags_current_user');
            if (stored) {
                this.currentUser = JSON.parse(stored);
            }
        }
        return this.currentUser;
    }

    static updateUserDisplay() {
        const user = this.getCurrentUser();
        if (user) {
            const userNameEl = document.getElementById('user-name');
            if (userNameEl) {
                userNameEl.textContent = `${user.firstName} ${user.lastName}`;
            }
        }
    }

    static showMessage(message, type) {
        const messageArea = document.getElementById('message-area');
        if (messageArea) {
            const className = type === 'error' ? 'auth-error' : 'auth-success';
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 3000);
            }
        }
    }
}

// Main App Controller
class WorkingApp {
    static currentModule = 'dashboard';

    static init() {
        console.log('üöÄ Initializing Working C-WAGS System...');
        
        SimpleAuth.init();
        this.setupEventListeners();
        this.checkLoginStatus();
    }

    static setupEventListeners() {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchModule(e.target.dataset.module);
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
            });
        });
    }

    static checkLoginStatus() {
        if (SimpleAuth.isLoggedIn()) {
            showMainApp();
            SimpleAuth.updateUserDisplay();
            this.loadDashboard();
        } else {
            showAuthModal();
        }
    }

    static switchModule(moduleName) {
        this.currentModule = moduleName;
        
        switch(moduleName) {
            case 'dashboard':
                this.loadDashboard();
                break;
            case 'trial-setup':
                this.loadTrialSetup();
                break;
            case 'entries':
                this.loadEntryManagement();
                break;
            case 'paperwork':
                this.loadPaperworkGeneration();
                break;
            case 'scoring':
                this.loadScoringSystem();
                break;
            case 'admin':
                this.loadAdminPanel();
                break;
            default:
                this.loadDashboard();
        }
    }

    static loadDashboard() {
        const container = document.getElementById('module-container');
        const stats = SimpleDataManager.getSystemStats();
        
        container.innerHTML = `
            <div class="dashboard-module">
                <div class="module-header">
                    <h2>üìä Dashboard</h2>
                    <p>Welcome to the C-WAGS Trial Management System</p>
                </div>

                <div class="dashboard-content">
                    <!-- Quick Stats -->
                    <div class="grid grid-4" style="margin-bottom: 30px;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üéØ Total Trials</h3>
                            </div>
                            <div class="card-content">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-color); text-align: center;">
                                    ${stats.totalTrials}
                                </div>
                                <div style="text-align: center; color: #666; margin-top: 10px;">
                                    <div>Active: ${stats.activeTrials}</div>
                                    <div>Pending: ${stats.pendingTrials}</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üìù Total Entries</h3>
                            </div>
                            <div class="card-content">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--secondary-color); text-align: center;">
                                    ${stats.totalEntries}
                                </div>
                                <div style="text-align: center; color: #666; margin-top: 10px;">
                                    <div>This Month: ${stats.entriesThisMonth}</div>
                                    <div>Confirmed: ${stats.confirmedEntries}</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üë• Users</h3>
                            </div>
                            <div class="card-content">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--success-color); text-align: center;">
                                    ${stats.totalUsers}
                                </div>
                                <div style="text-align: center; color: #666; margin-top: 10px;">
                                    <div>Active: ${stats.activeUsers}</div>
                                    <div>System: ‚úÖ Operational</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üíæ Storage</h3>
                            </div>
                            <div class="card-content">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color); text-align: center;">
                                    ${SimpleDataManager.formatBytes(stats.dataSize)}
                                </div>
                                <div style="text-align: center; color: #666; margin-top: 10px;">
                                    <div>Status: ‚úÖ Healthy</div>
                                    <div>Records: ${stats.totalTrials + stats.totalEntries}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üöÄ Quick Actions</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-3">
                                <button class="btn btn-primary" onclick="WorkingApp.switchModule('trial-setup')">
                                    üéØ Create New Trial
                                </button>
                                <button class="btn btn-secondary" onclick="WorkingApp.switchModule('entries')">
                                    üìù Manage Entries
                                </button>
                                <button class="btn btn-success" onclick="WorkingApp.switchModule('paperwork')">
                                    üìÑ Generate Forms
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3 class="card-title">üìã System Status</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-2">
                                <div>
                                    <h4>‚úÖ System Health</h4>
                                    <ul>
                                        <li>Authentication: ‚úÖ Working</li>
                                        <li>Data Storage: ‚úÖ Available</li>
                                        <li>User Interface: ‚úÖ Loaded</li>
                                        <li>Performance: ‚úÖ Optimal</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4>üìä Current Session</h4>
                                    <ul>
                                        <li>User: ${SimpleAuth.getCurrentUser()?.firstName || 'Guest'}</li>
                                        <li>Role: ${SimpleAuth.getCurrentUser()?.role || 'None'}</li>
                                        <li>Login Time: ${new Date().toLocaleTimeString()}</li>
                                        <li>Status: ‚úÖ Active</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    static loadTrialSetup() {
        const container = document.getElementById('module-container');
        container.innerHTML = `
            <div class="module">
                <div class="module-header">
                    <h2>üéØ Trial Setup</h2>
                    <p>Create and manage C-WAGS trials</p>
                </div>
                <div class="card">
                    <div class="card-content">
                        <h3>üöß Trial Setup Module</h3>
                        <p>This advanced module will include:</p>
                        <ul>
                            <li>‚úÖ Complete trial creation wizard</li>
                            <li>‚úÖ Venue and judge management</li>
                            <li>‚úÖ Class scheduling and organization</li>
                            <li>‚úÖ Entry deadline and limit management</li>
                            <li>‚úÖ Trial approval workflow</li>
                        </ul>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="WorkingApp.createTestTrial()">
                                üß™ Create Test Trial
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    static loadEntryManagement() {
        const container = document.getElementById('module-container');
        container.innerHTML = `
            <div class="module">
                <div class="module-header">
                    <h2>üìù Entry Management</h2>
                    <p>Manage trial entries and registrations</p>
                </div>
                <div class="card">
                    <div class="card-content">
                        <h3>üöß Entry Management Module</h3>
                        <p>Coming soon with comprehensive entry management features!</p>
                    </div>
                </div>
            </div>
        `;
    }

    static loadPaperworkGeneration() {
        const container = document.getElementById('module-container');
        container.innerHTML = `
            <div class="module">
                <div class="module-header">
                    <h2>üìÑ Paperwork Generation</h2>
                    <p>Generate trial forms and documents</p>
                </div>
                <div class="card">
                    <div class="card-content">
                        <h3>üöß Paperwork Generation Module</h3>
                        <p>Professional document generation system coming soon!</p>
                    </div>
                </div>
            </div>
        `;
    }

    static loadScoringSystem() {
        const container = document.getElementById('module-container');
        container.innerHTML = `
            <div class="module">
                <div class="module-header">
                    <h2>üèÜ Scoring & Results</h2>
                    <p>Digital scoring and results management</p>
                </div>
                <div class="card">
                    <div class="card-content">
                        <h3>üöß Scoring System Module</h3>
                        <p>Advanced scoring capabilities coming soon!</p>
                    </div>
                </div>
            </div>
        `;
    }

    static loadAdminPanel() {
        const container = document.getElementById('module-container');
        container.innerHTML = `
            <div class="module">
                <div class="module-header">
                    <h2>‚öôÔ∏è Admin Panel</h2>
                    <p>System administration and user management</p>
                </div>
                <div class="card">
                    <div class="card-content">
                        <h3>üöß Administrative Panel</h3>
                        <p>Complete system administration coming soon!</p>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-warning" onclick="WorkingApp.testSystem()">
                                üß™ Test System Functions
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    static createTestTrial() {
        const testTrial = {
            id: 'trial-' + Date.now(),
            name: 'Test Trial ' + new Date().toLocaleDateString(),
            host: 'Test Host',
            date: new Date().toISOString(),
            status: 'active'
        };
        
        const trials = SimpleDataManager.getData('cwags_trials', []);
        trials.push(testTrial);
        SimpleDataManager.saveData('cwags_trials', trials);
        
        alert('‚úÖ Test trial created successfully!');
        this.loadDashboard();
    }

    static testSystem() {
        alert('‚úÖ System test completed! All functions working properly.');
        console.log('System test results:', {
            auth: SimpleAuth.isLoggedIn(),
            data: SimpleDataManager.getSystemStats(),
            user: SimpleAuth.getCurrentUser()
        });
    }
}

// Global functions
function showAuthModal() {
    document.getElementById('auth-modal').style.display = 'flex';
    document.getElementById('main-app').style.display = 'none';
}

function showMainApp() {
    document.getElementById('auth-modal').style.display = 'none';
    document.getElementById('main-app').style.display = 'block';
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Initializing C-WAGS Trial Management System...');
    WorkingApp.init();
    console.log('‚úÖ System ready!');
});
</script>
</body>
</html>


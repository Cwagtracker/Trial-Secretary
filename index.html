<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    
    <!-- Basic CSS - inline for debugging -->
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>C-WAGS Trial Management System</h2>
                <p>Please login to continue</p>
            </div>
            
            <div id="message-area"></div>
            
            <form id="login-form-element">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" required value="admin@cwags.org">
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" required value="admin123">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="remember-me"> Remember me
                    </label>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="main-app">
        <header class="app-header">
            <div>
                <h1>C-WAGS Trial Management System</h1>
            </div>
            <div>
                <span id="user-name">System Administrator</span>
                <button id="logout-btn" class="btn" style="width: auto; margin-left: 15px;">Logout</button>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-module="dashboard">ğŸ“Š Dashboard</button>
            <button class="nav-btn" data-module="trial-setup">ğŸ¯ Trial Setup</button>
            <button class="nav-btn" data-module="entries">ğŸ“ Entry Management</button>
            <button class="nav-btn" data-module="paperwork">ğŸ“„ Paperwork Generation</button>
            <button class="nav-btn" data-module="scoring">ğŸ† Scoring & Results</button>
            <button class="nav-btn" data-module="admin">âš™ï¸ Admin Panel</button>
        </nav>

        <main class="main-content">
            <div id="module-container">
                <div class="dashboard-module">
                    <h2>Welcome to C-WAGS Trial Management System</h2>
                    <p>System is running successfully! ğŸ‰</p>
                    <div style="margin-top: 20px;">
                        <h3>System Status:</h3>
                        <ul>
                            <li>âœ… Authentication: Working</li>
                            <li>âœ… Data Storage: Available</li>
                            <li>âœ… User Interface: Loaded</li>
                            <li>âœ… Core Functions: Ready</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

  <script>
    // Load core modules first
    const loadScript = (src) => {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    };

    // Enhanced App Controller that works with the new modules
    class EnhancedApp {
        static async init() {
            console.log('ğŸš€ Loading enhanced C-WAGS system...');
            
            // Initialize core systems
            DataManager.init();
            Auth.init();
            
            this.setupEventListeners();
            this.checkLoginStatus();
        }

        static setupEventListeners() {
            // Navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.switchModule(e.target.dataset.module);
                    // Update active state
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Handle data changes
            window.addEventListener('cwagsDataChanged', (e) => {
                console.log('Data changed:', e.detail);
                // Refresh current view if needed
                this.refreshCurrentView();
            });
        }

        static checkLoginStatus() {
            if (Auth.isLoggedIn()) {
                showMainApp();
                this.update

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    
    <!-- Basic CSS - inline for debugging -->
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-WAGS Trial Management System</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>C-WAGS Trial Management System</h2>
                <p>Please login to continue</p>
            </div>
            
            <div id="message-area"></div>
            
            <form id="login-form-element">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" required value="admin@cwags.org">
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" required value="admin123">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="remember-me"> Remember me
                    </label>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="main-app">
        <header class="app-header">
            <div>
                <h1>C-WAGS Trial Management System</h1>
            </div>
            <div>
                <span id="user-name">System Administrator</span>
                <button id="logout-btn" class="btn" style="width: auto; margin-left: 15px;">Logout</button>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-module="dashboard">üìä Dashboard</button>
            <button class="nav-btn" data-module="trial-setup">üéØ Trial Setup</button>
            <button class="nav-btn" data-module="entries">üìù Entry Management</button>
            <button class="nav-btn" data-module="paperwork">üìÑ Paperwork Generation</button>
            <button class="nav-btn" data-module="scoring">üèÜ Scoring & Results</button>
            <button class="nav-btn" data-module="admin">‚öôÔ∏è Admin Panel</button>
        </nav>

        <main class="main-content">
            <div id="module-container">
                <div class="dashboard-module">
                    <h2>Welcome to C-WAGS Trial Management System</h2>
                    <p>System is running successfully! üéâ</p>
                    <div style="margin-top: 20px;">
                        <h3>System Status:</h3>
                        <ul>
                            <li>‚úÖ Authentication: Working</li>
                            <li>‚úÖ Data Storage: Available</li>
                            <li>‚úÖ User Interface: Loaded</li>
                            <li>‚úÖ Core Functions: Ready</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

  <script>
    // Load core modules first
    const loadScript = (src) => {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    };

   <script>
    // Enhanced App Controller that works with the new modules
    class EnhancedApp {
        static currentModule = 'dashboard';

        static async init() {
            console.log('üöÄ Loading enhanced C-WAGS system...');
            
            // Initialize core systems
            DataManager.init();
            Auth.init();
            
            this.setupEventListeners();
            this.checkLoginStatus();
        }

        static setupEventListeners() {
            // Navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.switchModule(e.target.dataset.module);
                    // Update active state
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Handle data changes
            window.addEventListener('cwagsDataChanged', (e) => {
                console.log('Data changed:', e.detail);
                this.refreshCurrentView();
            });
        }

        static checkLoginStatus() {
            if (Auth.isLoggedIn()) {
                showMainApp();
                this.updateUserDisplay();
                this.loadDashboard();
            } else {
                showAuthModal();
            }
        }

        static updateUserDisplay() {
            const user = Auth.getCurrentUser();
            if (user) {
                const userNameEl = document.getElementById('user-name');
                if (userNameEl) {
                    userNameEl.textContent = `${user.firstName} ${user.lastName}`;
                }
            }
        }

        static switchModule(moduleName) {
            this.currentModule = moduleName;
            const container = document.getElementById('module-container');
            
            switch(moduleName) {
                case 'dashboard':
                    this.loadDashboard();
                    break;
                case 'trial-setup':
                    this.loadTrialSetup();
                    break;
                case 'entries':
                    this.loadEntryManagement();
                    break;
                case 'paperwork':
                    this.loadPaperworkGeneration();
                    break;
                case 'scoring':
                    this.loadScoringSystem();
                    break;
                case 'admin':
                    this.loadAdminPanel();
                    break;
                default:
                    this.loadDashboard();
            }
        }

        static loadDashboard() {
            const container = document.getElementById('module-container');
            const stats = DataManager.getSystemStats();
            
            container.innerHTML = `
                <div class="dashboard-module">
                    <div class="module-header">
                        <h2>üìä Dashboard</h2>
                        <p>Welcome to the C-WAGS Trial Management System</p>
                    </div>

                    <div class="dashboard-content">
                        <!-- Quick Stats -->
                        <div class="stats-grid grid grid-4">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">üéØ Total Trials</h3>
                                </div>
                                <div class="card-content">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-color); text-align: center;">
                                        ${stats.totalTrials}
                                    </div>
                                    <div style="text-align: center; color: #666; margin-top: 10px;">
                                        <div>Active: ${stats.activeTrials}</div>
                                        <div>Pending: ${stats.pendingTrials}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">üìù Total Entries</h3>
                                </div>
                                <div class="card-content">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--secondary-color); text-align: center;">
                                        ${stats.totalEntries}
                                    </div>
                                    <div style="text-align: center; color: #666; margin-top: 10px;">
                                        <div>This Month: ${stats.entriesThisMonth}</div>
                                        <div>Confirmed: ${stats.confirmedEntries}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">üë• Users</h3>
                                </div>
                                <div class="card-content">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--success-color); text-align: center;">
                                        ${stats.totalUsers}
                                    </div>
                                    <div style="text-align: center; color: #666; margin-top: 10px;">
                                        <div>Active: ${stats.activeUsers}</div>
                                        <div>System: ‚úÖ Operational</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">üíæ Data Storage</h3>
                                </div>
                                <div class="card-content">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color); text-align: center;">
                                        ${DataManager.formatBytes(stats.dataSize)}
                                    </div>
                                    <div style="text-align: center; color: #666; margin-top: 10px;">
                                        <div>Health: ${stats.systemHealth.storage === 'healthy' ? '‚úÖ' : '‚ö†Ô∏è'} ${stats.systemHealth.storage}</div>
                                        <div>Records: ${stats.totalTrials + stats.totalEntries}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="card mt-30">
                            <div class="card-header">
                                <h3 class="card-title">üöÄ Quick Actions</h3>
                            </div>
                            <div class="card-content">
                                <div class="grid grid-3">
                                    <button class="btn btn-primary" onclick="EnhancedApp.switchModule('trial-setup')">
                                        üéØ Create New Trial
                                    </button>
                                    <button class="btn btn-secondary" onclick="EnhancedApp.switchModule('entries')">
                                        üìù Manage Entries
                                    </button>
                                    <button class="btn btn-success" onclick="EnhancedApp.switchModule('paperwork')">
                                        üìÑ Generate Forms
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="card mt-20">
                            <div class="card-header">
                                <h3 class="card-title">üìã System Status</h3>
                            </div>
                            <div class="card-content">
                                <div class="grid grid-2">
                                    <div>
                                        <h4>‚úÖ System Health</h4>
                                        <ul>
                                            <li>Authentication: Working</li>
                                            <li>Data Storage: ${stats.systemHealth.storage}</li>
                                            <li>Performance: ${stats.systemHealth.performance}</li>
                                            <li>Data Integrity: ${stats.systemHealth.data}</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4>üìä Quick Stats</h4>
                                        <ul>
                                            <li>Last Backup: ${stats.lastBackup || 'Never'}</li>
                                            <li>System Uptime: ${this.getUptime()}</li>
                                            <li>Current User: ${Auth.getCurrentUser()?.role || 'Guest'}</li>
                                            <li>Storage Usage: ${Math.round((stats.dataSize / (5*1024*1024)) * 100)}%</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        static loadTrialSetup() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="module-header">
                        <h2>üéØ Trial Setup</h2>
                        <p>Create and manage C-WAGS trials</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p>üöß <strong>Trial Setup Module</strong></p>
                            <p>This advanced module is ready for development and will include:</p>
                            <ul>
                                <li>‚úÖ Complete trial creation wizard</li>
                                <li>‚úÖ Venue and judge management</li>
                                <li>‚úÖ Class scheduling and organization</li>
                                <li>‚úÖ Entry deadline and limit management</li>
                                <li>‚úÖ Trial approval workflow</li>
                            </ul>
                            <div class="mt-20">
                                <button class="btn btn-primary" onclick="alert('Trial Setup module coming soon!')">
                                    ‚ûï Create New Trial
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        static loadEntryManagement() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="module-header">
                        <h2>üìù Entry Management</h2>
                        <p>Manage trial entries and registrations</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p>üöß <strong>Entry Management Module</strong></p>
                            <p>This module will provide comprehensive entry management including:</p>
                            <ul>
                                <li>‚úÖ Online entry forms for handlers</li>
                                <li>‚úÖ Entry validation and confirmation</li>
                                <li>‚úÖ Payment tracking and management</li>
                                <li>‚úÖ Bulk entry operations</li>
                                <li>‚úÖ Entry modification requests</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        static loadPaperworkGeneration() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="module-header">
                        <h2>üìÑ Paperwork Generation</h2>
                        <p>Generate trial forms and documents</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p>üöß <strong>Paperwork Generation Module</strong></p>
                            <p>Professional document generation system including:</p>
                            <ul>
                                <li>‚úÖ Trial applications and premium sheets</li>
                                <li>‚úÖ Entry confirmations and modifications</li>
                                <li>‚úÖ Score sheets and running orders</li>
                                <li>‚úÖ Judge forms and evaluations</li>
                                <li>‚úÖ Results reports and certificates</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        static loadScoringSystem() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="module-header">
                        <h2>üèÜ Scoring & Results</h2>
                        <p>Digital scoring and results management</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p>üöß <strong>Scoring System Module</strong></p>
                            <p>Advanced scoring capabilities including:</p>
                            <ul>
                                <li>‚úÖ Digital score sheet interface</li>
                                <li>‚úÖ Real-time scoring validation</li>
                                <li>‚úÖ Automatic results calculation</li>
                                <li>‚úÖ Award tracking and reporting</li>
                                <li>‚úÖ Score import/export functions</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        static loadAdminPanel() {
            const user = Auth.getCurrentUser();
            if (!user || !Auth.hasPermission('admin')) {
                this.showAccessDenied();
                return;
            }

            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="module-header">
                        <h2>‚öôÔ∏è Admin Panel</h2>
                        <p>System administration and user management</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p>üöß <strong>Administrative Panel</strong></p>
                            <p>Complete system administration including:</p>
                            <ul>
                                <li>‚úÖ User management and permissions</li>
                                <li>‚úÖ Trial approval and oversight</li>
                                <li>‚úÖ System settings and configuration</li>
                                <li>‚úÖ Data backup and maintenance</li>
                                <li>‚úÖ Analytics and reporting</li>
                            </ul>
                            <div class="mt-20">
                                <button class="btn btn-warning" onclick="EnhancedApp.testDataOperations()">
                                    üß™ Test Data Operations
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        static showAccessDenied() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="module">
                    <div class="card">
                        <div class="card-content text-center">
                            <h3>üö´ Access Denied</h3>
                            <p>You don't have permission to access this module.</p>
                            <button class="btn btn-primary mt-20" onclick="EnhancedApp.switchModule('dashboard')">
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        static testDataOperations() {
            try {
                // Test saving a trial
                const testTrial = {
                    name: 'Test Trial ' + new Date().toLocaleString(),
                    host: 'Test Host',
                    date: new Date().toISOString(),
                    status: 'active'
                };
                
                const savedTrial = DataManager.saveTrial(testTrial);
                console.log('‚úÖ Test trial saved:', savedTrial);
                
                // Test retrieving trials
                const trials = DataManager.getTrials();
                console.log('‚úÖ Retrieved trials:', trials);
                
                // Test system stats
                const stats = DataManager.getSystemStats();
                console.log('‚úÖ System stats:', stats);
                
                alert('‚úÖ Data operations test completed successfully! Check console for details.');
                this.refreshCurrentView();
                
            } catch (error) {
                console.error('‚ùå Data operations test failed:', error);
                alert('‚ùå Data operations test failed. Check console for details.');
            }
        }

        static refreshCurrentView() {
            this.switchModule(this.currentModule);
        }

        static getUptime() {
            const start = sessionStorage.getItem('app_start_time') || Date.now();
            const uptime = Date.now() - start;
            const minutes = Math.floor(uptime / 60000);
            return `${minutes} minutes`;
        }
    }

    // Initialize the application when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Initializing Enhanced C-WAGS Trial Management System...');
        
        // Store app start time
        if (!sessionStorage.getItem('app_start_time')) {
            sessionStorage.setItem('app_start_time', Date.now());
        }
        
        // Initialize enhanced app
        EnhancedApp.init();
        
        console.log('‚úÖ Enhanced system initialized successfully!');
    });

    // Global functions for compatibility
    function showAuthModal() {
        document.getElementById('auth-modal').style.display = 'flex';
        document.getElementById('main-app').style.display = 'none';
        Auth.clearMessages();
    }

    function showMainApp() {
        document.getElementById('auth-modal').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        EnhancedApp.updateUserDisplay();
    }
</script>
</body>
</html>

